<html>
<head>

	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<div class="append-me"></div>
	<form>
		<label> Please Enter Your Salary</label>
		<input type="number" class="salary-input" value="45000"></input>
	</form>



		<script src="js/jquery-1.10.1.min.js"></script>
	<script src="js/underscore-min.js"></script>
	<script src="js/backbone-min.js"></script>
	<script id="viewTemplate" type="text/template">
	<% var salary = $('.salary-input').val(); %>
	<label> <%= name %> (<%= percentage * 100%>%) </label>
	<input type="number" value="<%= percentage * salary / 12 %>" />


	</script>
	<script>

		
		var Expense = Backbone.Model.extend({
			defaults: {
				name: 'New Expense',
				percentage: .05, 
				dollars: 500
			},
			initialize: function(){
				console.log("New expense initialized.");
			}
		});
		
		var Expenses = Backbone.Collection.extend({
			model: Expense,
			defaults: {
				location: "philadelphia-PA",
				salary: 45000,
				paycheck: 45000/12
			},
			initialize: function() {
				var percentages = 0
				this.each(function(expense){
					percentages = percentages + expense.get("percentage");
					});
				additionalPayments.set({percentage: 1 - percentages});
				console.log("Initialized Expenses collection");
				}
			});


		var ExpenseView = Backbone.View.extend({
			el: 'body',

			initialize: function() {
				this.render(); 
			},

			render: function() {
				var data = this.model.toJSON(); 
				var template = _.template($('#viewTemplate').text(), data);
				console.log("Render called");
				this.$el.append(template);
				return this; 
			}
		});

		var salary = 45000;
		var rent = new Expense({name: "Rent", percentage: .3, dollars: 900}); 
		var food = new Expense({name: "Food", percentage: .05});
		var transportation = new Expense({name: "Transportation", percentage: .05});
		var utilities = new Expense({name: "Utilities", percentage: .05});
		var health = new Expense({name: "Health", percentage: .05});
		var fun = new Expense({name: "Fun", percentage: .05});
		var generalSavings = new Expense({name: "General Savings", percentage: .1});
		var additionalPayments = new Expense({name: "Additional Payments"});


		var m = new Backbone.Model({text: new Date().toString()});
		var myExpenses = new Expenses([rent, food, transportation, utilities, health, fun, generalSavings, additionalPayments]);
		myExpenses.each(function(expense){
			var v = new ExpenseView({ model : expense});
			console.log("Added new ExpenseView");
		})
	

		//when a user enters a new salary value, recalculate the estimated values for the relevant expenses
		$(document).ready(function() {

				$('.salary-input').on("keyup", function() {
					var salary = $(this).val();
					myExpenses.each(function(expense){
						expense.set({"dollars": "120"});
					}); 
					console.log("renamed");
				});
		//end document-ready function
		});

		//Next Tasks
		//Create template for the view
		//View should re-render when any change occurs

	</script>
</body>
</html>